\section{Installation}

\subsection{Prerequisites}

\begin{itemize}
\item Python 1.5.2 or later.

\item C compiler

The \module{Sybase} package contains an extension module written in C.
The extension module is used by the Python wrapper module
\module{Sybase.py}.

\item Sybase client libraries

The \module{Sybase} package uses the Sybase client libraries which
should have come as part of your Sybase installation.

If you are using Linux, Sybase provide a free version of their
database which can be downloaded from \url{http://linux.sybase.com/}.

\item mxDateTime

If the \module{mxDateTime} package is installed the \module{Sybase}
module can return \code{datetime} values as \class{DateTime} objects.
If \module{mxDateTime} is not present the module will use the
\class{DateTime} object defined in the \module{sybasect} extension
module.
\end{itemize}
\subsection{Installing}

The \module{Sybase} package uses the \module{distutils} package so all
you need to do is type the following command as root:

\begin{verbatim}
python setup.py install
\end{verbatim}

To disable bulkcopy support you should use the following commands:

\begin{verbatim}
python setup.py build_ext -U WANT_BULKCOPY
python setup.py install
\end{verbatim}

The default build does not enable threading in the extension module so
if you want threading enabled you will have to do this:

\begin{verbatim}
python setup.py build_ext -D WANT_THREADS
python setup.py install
\end{verbatim}

There is some initial work to support FreeTDS.  One of the problems
with FreeTDS is that it does not support inline error handling.  The
callback error handling works well if you do not compile for threads
support, but causes problems when compiled for threading.

The problem occurs when the extension module releases the global
interpreter lock when calling the Sybase CT library.  A Python
callback causes the interpreter to be reentered by the callback which
leads to bad things when the following warning from the Python include
file \texttt{ceval.h} is violated:

\begin{quote}
\begin{verbatim}
  WARNING: NEVER NEST CALLS TO Py_BEGIN_ALLOW_THREADS AND
  Py_END_ALLOW_THREADS!!!
\end{verbatim}
\end{quote}

At the moment the module will compile for FreeTDS (at least it does
on my machine) and some things do work.  All you have to do is
compile like this:

\begin{verbatim}
python setup.py build_ext -D HAVE_FREETDS -U WANT_BULKCOPY
python setup.py install
\end{verbatim}

There is no error handling and reporting for FreeTDS yet.

If you have problems with the installation step, edit the
\texttt{setup.py} file to specify where Sybase is installed and the
name of the client libraries.  Make sure that you contact the package
author so that the installation process can be made more robust for
other people.

\subsection{Testing}

The most simple way to test the \module{Sybase} package is to run a
test application.  The arguments to the \function{Sybase.connect()}
function are \var{server} (from the interfaces file), \var{username},
\var{password}, and \var{database}.  The \var{database} argument is
optional.  Make sure you substitute values that will work in your
environment.

\begin{verbatim}
>>> import Sybase
>>> db = Sybase.connect('SYBASE', 'sa', '')
>>> c = db.cursor()
>>> c.callproc('sp_help')
>>> for t in c.description:
...     print t
... 
('Name', 0, 0, 30, 0, 0, 0)
('Owner', 0, 0, 30, 0, 0, 32)
('Object_type', 0, 0, 22, 0, 0, 32)
>>> for r in c.fetchall():
...     print r
... 
('spt_datatype_info', 'dbo', 'user table')
('spt_datatype_info_ext', 'dbo', 'user table')
('spt_limit_types', 'dbo', 'user table')
  :
  :
('sp_prtsybsysmsgs', 'dbo', 'stored procedure')
('sp_validlang', 'dbo', 'stored procedure')
>>> c.nextset()
1
>>> for t in c.description:
...     print t
... 
('User_type', 0, 0, 15, 0, 0, 0)
('Storage_type', 0, 0, 15, 0, 0, 0)
('Length', 6, 0, 1, 0, 0, 0)
('Nulls', 11, 0, 1, 0, 0, 0)
('Default_name', 0, 0, 15, 0, 0, 32)
('Rule_name', 0, 0, 15, 0, 0, 32)
\end{verbatim}
